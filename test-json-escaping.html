<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON Escaping Test</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            max-width: 1000px;
            margin: 0 auto;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-input {
            background: #f0f0f0;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            border-left: 4px solid #667eea;
        }
        .test-output {
            background: #e8f5e9;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            border-left: 4px solid #4caf50;
            word-wrap: break-word;
        }
        .test-error {
            background: #ffebee;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            border-left: 4px solid #f44336;
        }
        h1 { color: #667eea; }
        h2 { color: #333; margin-top: 0; }
        .pass { color: #4caf50; font-weight: bold; }
        .fail { color: #f44336; font-weight: bold; }
    </style>
</head>
<body>
    <h1>üß™ JSON Escaping Test Suite</h1>
    <p>This tests that user input with quotes, apostrophes, newlines, and special characters is properly handled for webhook submissions.</p>

    <div id="test-results"></div>

    <script>
        const testCases = [
            {
                name: "Double quotes in text",
                input: 'I said "hello" to my colleague and she replied "hi there"',
            },
            {
                name: "Single quotes/apostrophes in text",
                input: "I can't believe it's already Friday! My boss's expectations are high.",
            },
            {
                name: "Mixed quotes",
                input: 'She said "I don\'t think this is right" and I replied "Let\'s discuss it"',
            },
            {
                name: "Newlines and line breaks",
                input: "First line\nSecond line\nThird line with a point.",
            },
            {
                name: "Backslashes",
                input: "The file path is C:\\Users\\John\\Documents\\file.txt",
            },
            {
                name: "Special characters",
                input: "Email: john@example.com, symbols: <>&%, emoji: üòä, unicode: caf√©",
            },
            {
                name: "Complex nested case",
                input: 'User wrote: "I think she said \'maybe\', but I\'m not sure.\nLet\'s check C:\\data\\logs.txt"',
            },
            {
                name: "Empty string",
                input: "",
            },
            {
                name: "Very long text with quotes",
                input: "Lorem ipsum \"dolor\" sit amet, consectetur 'adipiscing' elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. \"Ut enim\" ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. 'Duis aute' irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.",
            }
        ];

        function runTests() {
            const resultsDiv = document.getElementById('test-results');
            let passCount = 0;
            let failCount = 0;

            testCases.forEach((testCase, index) => {
                const testSection = document.createElement('div');
                testSection.className = 'test-section';

                const testHeader = document.createElement('h2');
                testHeader.textContent = `Test ${index + 1}: ${testCase.name}`;
                testSection.appendChild(testHeader);

                const inputDiv = document.createElement('div');
                inputDiv.className = 'test-input';
                inputDiv.innerHTML = `<strong>Input:</strong><br>${escapeHtml(testCase.input)}`;
                testSection.appendChild(inputDiv);

                try {
                    // Simulate the webhook data structure
                    const data = {
                        studentName: "Test User",
                        responses: {
                            testField: testCase.input
                        },
                        timestamp: Date.now()
                    };

                    // This is the critical line - JSON.stringify should handle all escaping
                    const jsonPayload = JSON.stringify(data);

                    // Verify it can be parsed back
                    const parsed = JSON.parse(jsonPayload);

                    // Verify the data is preserved correctly
                    if (parsed.responses.testField === testCase.input) {
                        const outputDiv = document.createElement('div');
                        outputDiv.className = 'test-output';
                        outputDiv.innerHTML = `<strong class="pass">‚úì PASS</strong><br><strong>JSON Payload:</strong><br>${escapeHtml(jsonPayload)}`;
                        testSection.appendChild(outputDiv);
                        passCount++;
                    } else {
                        const errorDiv = document.createElement('div');
                        errorDiv.className = 'test-error';
                        errorDiv.innerHTML = `<strong class="fail">‚úó FAIL</strong><br>Data was modified during JSON encoding/decoding<br>Expected: ${escapeHtml(testCase.input)}<br>Got: ${escapeHtml(parsed.responses.testField)}`;
                        testSection.appendChild(errorDiv);
                        failCount++;
                    }
                } catch (error) {
                    const errorDiv = document.createElement('div');
                    errorDiv.className = 'test-error';
                    errorDiv.innerHTML = `<strong class="fail">‚úó FAIL</strong><br>Error: ${escapeHtml(error.message)}`;
                    testSection.appendChild(errorDiv);
                    failCount++;
                }

                resultsDiv.appendChild(testSection);
            });

            // Summary
            const summaryDiv = document.createElement('div');
            summaryDiv.className = 'test-section';
            summaryDiv.innerHTML = `
                <h2>Test Summary</h2>
                <p><strong class="pass">Passed: ${passCount}/${testCases.length}</strong></p>
                <p><strong class="fail">Failed: ${failCount}/${testCases.length}</strong></p>
                ${failCount === 0 ? '<p style="color: #4caf50; font-size: 1.2em;">üéâ All tests passed! JSON escaping is working correctly.</p>' : '<p style="color: #f44336; font-size: 1.2em;">‚ö†Ô∏è Some tests failed. Please review the errors above.</p>'}
            `;
            resultsDiv.appendChild(summaryDiv);
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Run tests when page loads
        window.addEventListener('DOMContentLoaded', runTests);
    </script>
</body>
</html>
